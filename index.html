<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الاشتراكات علي شوب</title>

    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap">

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

    <!-- AOS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Arabic Font (Cairo) -->
<script src="https://cdn.jsdelivr.net/npm/@almogtamaa/jspdf-arabic@1.0.2/dist/jspdf-arabic.min.js"></script>
    <style>
/* ==========================================================================
   Theme Variables
   ========================================================================== */

:root {
  /* Light Mode Colors */
  --primary-color: #1e3a8a;
  --secondary-color: #4b6cb7;
  --accent-color: #dc3545;
  --bg-color: #e2e8f0;
  --card-bg: rgba(255, 255, 255, 0.15);
  --text-color: #1f2937;
  --muted-color: #6b7280;
  --glass-border: 1px solid rgba(255, 255, 255, 0.2);
  --shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
  --body-bg: linear-gradient(135deg, #c3dafe, #e0e7ff);
  --navbar-bg: rgba(30, 58, 138, 0.2);
  --login-bg: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  --dashboard-bg: linear-gradient(135deg, #e2e8f0, #f8fafc);
  --form-control-bg: rgba(255, 255, 255, 0.3);
  --form-control-focus-bg: rgba(255, 255, 255, 0.5);
  --card-header-bg: rgba(30, 58, 138, 0.8);
  --btn-primary-bg: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
  --btn-success-bg: linear-gradient(45deg, #2f855a, #38a169);
  --btn-warning-bg: linear-gradient(45deg, #d69e2e, #ecc94b);
  --btn-danger-bg: linear-gradient(45deg, #c53030, #e53e3e);
  --status-active-bg: #38a169;
  --status-warning-bg: #d69e2e;
  --status-expired-bg: #6b7280;
  --info-row-even-bg: rgba(255, 255, 255, 0.05);
  --action-bar-bg: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] {
  /* Dark Mode with Glassmorphism */
  --primary-color: #60a5fa;
  --secondary-color: #93c5fd;
  --accent-color: #f87171;
  --bg-color: #111827;
  --card-bg: rgba(31, 41, 55, 0.3);
  --text-color: #e5e7eb;
  --muted-color: #9ca3af;
  --glass-border: 1px solid rgba(255, 255, 255, 0.1);
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  --body-bg: linear-gradient(135deg, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.95));
  --navbar-bg: rgba(17, 24, 39, 0.4);
  --login-bg: linear-gradient(135deg, rgba(17, 24, 39, 0.9), rgba(31, 41, 55, 0.9));
  --dashboard-bg: linear-gradient(135deg, rgba(17, 24, 39, 0.9), rgba(31, 41, 55, 0.9));
  --form-control-bg: rgba(55, 65, 81, 0.4);
  --form-control-focus-bg: rgba(75, 85, 99, 0.6);
  --card-header-bg: rgba(31, 41, 55, 0.5);
  --btn-primary-bg: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
  --btn-success-bg: linear-gradient(45deg, #34d399, #4ade80);
  --btn-warning-bg: linear-gradient(45deg, #f59e0b, #fbbf24);
  --btn-danger-bg: linear-gradient(45deg, #ef4444, #f87171);
  --status-active-bg: #34d399;
  --status-warning-bg: #f59e0b;
  --status-expired-bg: #6b7280;
  --info-row-even-bg: rgba(55, 65, 81, 0.15);
  --action-bar-bg: rgba(31, 41, 55, 0.4);
}

/* ==========================================================================
   Base Styles
   ========================================================================== */

body {
  font-family: "Cairo", sans-serif;
  background: var(--body-bg);
  color: var(--text-color);
  direction: rtl;
  margin: 0;
  overflow-x: hidden;
  transition: background 0.3s ease, color 0.3s ease;
}

/* Glassmorphism Effect */
.glass-effect {
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: var(--glass-border);
  box-shadow: var(--shadow);
  border-radius: 16px;
  transition: background 0.3s ease, box-shadow 0.3s ease;
}

/* ==========================================================================
   Navbar
   ========================================================================== */

.navbar {
  background: var(--navbar-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  padding: 0.75rem 2rem;
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: var(--glass-border);
  transition: all 0.3s ease;
}

.navbar.active {
  display: block;
}

.navbar-brand {
  color: #fff !important;
  font-size: 1.5rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: color 0.3s ease, transform 0.3s ease;
}

.navbar-brand:hover {
  color: var(--secondary-color) !important;
  transform: translateY(-2px);
}

.navbar-brand i {
  font-size: 1.3rem;
}

.navbar-nav {
  gap: 1rem;
  align-items: center;
}

.nav-link {
  color: #fff !important;
  font-size: 1rem;
  font-weight: 500;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
}

.nav-link:hover,
.nav-link.active {
  background: var(--btn-primary-bg);
  color: #fff !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
}

.nav-link i {
  font-size: 1.1rem;
}

.nav-link::after {
  content: '';
  position: absolute;
  bottom: -4px;
  right: 50%;
  transform: translateX(50%);
  width: 0;
  height: 2px;
  background: var(--secondary-color);
  transition: width 0.3s ease;
}

.nav-link:hover::after,
.nav-link.active::after {
  width: 50%;
}

.navbar-toggler {
  border: none;
  padding: 0.5rem;
}

.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(255,255,255,0.9)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
  width: 24px;
  height: 24px;
}

.theme-toggle {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  background: var(--card-bg);
  color: #fff;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  
}

.theme-toggle:hover {
  background: var(--btn-primary-bg);
  box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
  transform: translateY(-2px);
  text-decoration: none;
}

.theme-toggle i {
  font-size: 1.1rem;
}

/* Responsive Adjustments */
@media (max-width: 992px) {
  .navbar-nav {
    padding: 1rem 0;
    background: var(--navbar-bg);
    border-radius: 8px;
    margin-top: 0.5rem;
  }

  .nav-link {
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
  }

  .theme-toggle {
    margin: 0.5rem 1.5rem;
  }
}

@media (max-width: 576px) {
  .navbar {
    padding: 0.5rem 1rem;
  }

  .navbar-brand {
    font-size: 1.2rem;
  }

  .nav-link {
    font-size: 1rem;
    padding: 0.6rem 1.2rem;
  }
}
/* Bottom Navbar Modern Animated */
.bottom-navbar {
  position: fixed;
  bottom: 15px;
  right: 20px;
  left: 20px;
  height: 65px;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 1000;
  transition: all 0.4s ease;
  border: 1px solid rgba(255, 255, 255, 0.3);
}
/* تحسين مظهر الناف بار السفلي */
#bottomNavbar {
    background: var(--navbar-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: var(--shadow);
    border: var(--glass-border);
}

/* الأزرار */
.bottom-navbar .nav-link {
  flex-grow: 1;
  text-align: center;
  font-size: 0.85rem;
  padding: 6px 0;
  transition: all 0.3s ease;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #1f2937; /* لون ثابت داكن للوضع النهاري */
}

/* الأيقونات */
.bottom-navbar .nav-link i {
  font-size: 1.4rem;
  margin-bottom: 3px;
  transition: transform 0.3s ease, color 0.3s ease;
}

/* عند التحويم */
.bottom-navbar .nav-link:hover {
  color: var(--primary-color);
  transform: translateY(-4px);
}

.bottom-navbar .nav-link:hover i {
  transform: scale(1.2);
  color: var(--primary-color);
}

/* الضغط */
.bottom-navbar .nav-link:active {
  transform: scale(0.95);
}

/* العنصر النشط */
.bottom-navbar .nav-link.active {
  color: var(--primary-color);
}

.bottom-navbar .nav-link.active i {
  color: var(--primary-color);
}

/* تبعيد بين المحتوى والناف بار */
#dashboardPage,
#subscriptionFormPage,
#subscriptionSummaryPage {
  padding-bottom: 100px;
}
@media (max-width: 768px) {
  #dashboardPage,
  #subscriptionFormPage,
  #subscriptionSummaryPage {
    padding-bottom: 90px;
  }
}

/* الوضع الليلي - تغيير لون النص */
[data-theme="dark"] .bottom-navbar .nav-link {
  color: #e5e7eb; /* لون فاتح للوضع الليلي */
}

[data-theme="dark"] .bottom-navbar .nav-link.active,
[data-theme="dark"] .bottom-navbar .nav-link:hover {
  color: var(--primary-color);
}
/* ==========================================================================
   Login Page
   ========================================================================== */

.login-page {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: var(--login-bg);
  padding: 2rem;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}
.login-card {
  background: var(--card-bg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: var(--glass-border);
  border-radius: 20px;
  box-shadow: var(--shadow);
  max-width: 400px;
  width: 100%;
  overflow: hidden;
  animation: slideUp 0.5s ease-in-out;
}
.login-card-header {
  background: var(--card-header-bg);
  color: #fff;
  padding: 1.5rem;
  text-align: center;
  font-size: 1.5rem;
  font-weight: 700;
  border-radius: 20px 20px 0 0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.login-card-body {
  padding: 2rem;
}
.form-control {
  background: var(--form-control-bg);
  border: none;
  border-radius: 10px;
  padding: 0.75rem;
  color: var(--text-color);
  transition: background 0.3s ease, box-shadow 0.3s ease;
}
.form-control:focus {
  background: var(--form-control-focus-bg);
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
  outline: none;
}
.form-control::placeholder {
  color: var(--muted-color);
}
.form-label {
  font-weight: 600;
  color: var(--text-color);
}
.btn-login {
  background: var(--btn-primary-bg);
  border: none;
  border-radius: 10px;
  padding: 0.75rem;
  font-weight: 600;
  color: #fff;
  width: 100%;
  transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}
.btn-login:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(96, 165, 250, 0.5); /* Neon Glow Effect */
}
.error-message {
  color: var(--accent-color);
  font-size: 0.9rem;
  margin-top: 0.5rem;
  display: none;
  animation: fadeIn 0.3s ease-in-out;
}

/* ==========================================================================
   Cards
   ========================================================================== */

.card {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: var(--glass-border);
  border-radius: 16px;
  box-shadow: var(--shadow);
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}
.card-header {
  background: var(--card-header-bg);
  color: #fff;
  font-weight: 600;
  padding: 1.5rem;
  text-align: center;
  border-radius: 16px 16px 0 0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.card-body {
  padding: 2rem;
}

/* ==========================================================================
   Buttons
   ========================================================================== */

.btn-primary,
.btn-success,
.btn-warning,
.btn-danger {
  border: none;
  border-radius: 8px;
  padding: 0.5rem 1.25rem;
  font-size: 0.9rem;
  font-weight: 500;
  color: #fff;
  transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}
.btn-primary {
  background: var(--btn-primary-bg);
}
.btn-success {
  background: var(--btn-success-bg);
}
.btn-warning {
  background: var(--btn-warning-bg);
}
.btn-danger {
  background: var(--btn-danger-bg);
}
.btn-primary:hover,
.btn-success:hover,
.btn-warning:hover,
.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.3); /* Neon Glow */
}

/* ==========================================================================
   Dashboard
   ========================================================================== */

.dashboard-page {
  padding: 2rem;
  min-height: 100vh;
  background: var(--dashboard-bg);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}
.dashboard-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}
.dashboard-card {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: var(--glass-border);
  border-radius: 16px;
  padding: 1.5rem;
  text-align: center;
  box-shadow: var(--shadow);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.dashboard-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}
.dashboard-card h5 {
  font-size: 1.1rem;
  color: var(--muted-color);
  margin-bottom: 1rem;
}
.dashboard-card p {
  font-size: 2rem;
  font-weight: 700;
  background: var(--btn-primary-bg);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ==========================================================================
   Summary Card
   ========================================================================== */

.summary-card {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: var(--glass-border);
  border-radius: 12px;
  margin-bottom: 0.5rem;
  box-shadow: var(--shadow);
  overflow: hidden;
  transition: transform 0.3s ease;
}
.summary-card:hover {
  transform: translateY(-5px);
}
.summary-card .header {
  background: var(--card-header-bg);
  padding: 1.25rem 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  border-radius: 12px 12px 0 0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.summary-card .header h5 {
  margin: 0;
  font-size: 1.2rem;
  color: #fff;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}
.summary-card .header .status-badge {
  font-size: 0.85rem;
  padding: 0.3rem 0.75rem;
  border-radius: 12px;
  font-weight: 500;
  color: #fff;
}
.status-badge.active {
  background: var(--status-active-bg);
}
.status-badge.warning {
  background: var(--status-warning-bg);
}
.status-badge.expired {
  background: var(--status-expired-bg);
}
.summary-card .header i.fa-chevron-down,
.summary-card .header i.fa-chevron-up {
  color: #fff;
  font-size: 1rem;
  transition: transform 0.3s ease;
}
.summary-card.expanded .header i.fa-chevron-down {
  transform: rotate(180deg);
}
.summary-card .content {
  display: none;
  padding: 0;
  background: var(--card-bg);
  border-radius: 0 0 12px 12px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}
.summary-card.expanded .content {
  display: block;
}

/* ==========================================================================
   Info Container
   ========================================================================== */

.info-container {
  padding: 1.5rem;
}
.info-table {
  display: table;
  width: 100%;
  border-collapse: collapse;
}
.info-row {
  display: table-row;
}
.info-row:nth-child(even) {
  background: var(--info-row-even-bg);
}
.info-row .label,
.info-row .value {
  display: table-cell;
  padding: 0.75rem 1rem;
  font-size: 0.95rem;
  vertical-align: middle;
}
.info-row .label {
  font-weight: 600;
  color: var(--text-color);
  width: 40%;
  border-left: 1px solid var(--glass-border);
}
.info-row .value {
  color: var(--text-color);
}
.info-row i {
  margin-left: 0.5rem;
  color: var(--secondary-color);
}

/* ==========================================================================
   Action Bar
   ========================================================================== */

.action-bar {
  padding: 1rem 1.5rem;
  background: var(--action-bar-bg);
  border-top: 1px solid var(--glass-border);
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

/* ==========================================================================
   Loading Overlay
   ========================================================================== */

.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--card-bg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  visibility: hidden;
  opacity: 0;
  transition: visibility 0s, opacity 0.5s ease-in-out;
  overflow: hidden;
}

.loading-overlay.active {
  visibility: visible;
  opacity: 1;
}

.loading-content {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}

/* Energy Core (Central Animation) */
.energy-core {
  width: 60px;
  height: 60px;
  background: radial-gradient(circle, var(--primary-color) 0%, transparent 70%);
  border-radius: 50%;
  position: relative;
  animation: pulse 1.5s infinite ease-in-out;
  box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--secondary-color);
}

.energy-core::before,
.energy-core::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  border: 2px solid var(--secondary-color);
  width: 80px;
  height: 80px;
  opacity: 0.5;
  animation: ripple 2s infinite ease-in-out;
}

.energy-core::after {
  animation-delay: 0.5s;
  width: 100px;
  height: 100px;
}

/* Particles */
.particle-container {
  position: absolute;
  width: 200px;
  height: 200px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.particle {
  position: absolute;
  width: 8px;
  height: 8px;
  background: var(--secondary-color);
  border-radius: 50%;
  box-shadow: 0 0 10px var(--secondary-color);
  animation: floatParticle 4s infinite ease-in-out;
}

.particle:nth-child(1) { animation-delay: 0s; left: 20%; top: 20%; }
.particle:nth-child(2) { animation-delay: 0.5s; left: 80%; top: 30%; }
.particle:nth-child(3) { animation-delay: 1s; left: 30%; top: 70%; }
.particle:nth-child(4) { animation-delay: 1.5s; left: 70%; top: 80%; }
.particle:nth-child(5) { animation-delay: 2s; left: 50%; top: 50%; }

/* Loading Text */
.loading-text {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-color);
  text-shadow: 0 0 10px var(--primary-color);
  animation: textGlow 2s infinite ease-in-out;
  position: relative;
  overflow: hidden;
}

.loading-text::after {
  content: 'جاري التحميل';
  position: absolute;
  top: 0;
  right: 0;
  color: var(--secondary-color);
  width: 0;
  overflow: hidden;
  animation: typing 2s infinite steps(10);
}

/* Animations */
@keyframes pulse {
  0% {
    transform: scale(1);
    box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--secondary-color);
  }
  50% {
    transform: scale(1.2);
    box-shadow: 0 0 30px var(--primary-color), 0 0 60px var(--secondary-color);
  }
  100% {
    transform: scale(1);
    box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--secondary-color);
  }
}

@keyframes ripple {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.5;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.5);
    opacity: 0;
  }
}

@keyframes floatParticle {
  0% {
    transform: translate(0, 0);
    opacity: 1;
  }
  50% {
    transform: translate(calc(50px * var(--random-x)), calc(50px * var(--random-y)));
    opacity: 0.5;
  }
  100% {
    transform: translate(0, 0);
    opacity: 1;
  }
}

@keyframes textGlow {
  0% {
    text-shadow: 0 0 10px var(--primary-color);
  }
  50% {
    text-shadow: 0 0 20px var(--primary-color), 0 0 30px var(--secondary-color);
  }
  100% {
    text-shadow: 0 0 10px var(--primary-color);
  }
}

@keyframes typing {
  0% {
    width: 0;
  }
  50% {
    width: 100%;
  }
  100% {
    width: 0;
  }
}

/* Theme Adjustments */
[data-theme="dark"] .energy-core {
  background: radial-gradient(circle, var(--primary-color) 0%, transparent 70%);
  box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--secondary-color);
}

[data-theme="dark"] .particle {
  background: var(--secondary-color);
  box-shadow: 0 0 10px var(--secondary-color);
}

[data-theme="dark"] .loading-text {
  color: var(--text-color);
  text-shadow: 0 0 10px var(--primary-color);
}

/* ==========================================================================
   Animations
   ========================================================================== */

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.fade-in {
  animation: slideUp 0.5s ease-in-out;
}
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ==========================================================================
   Background Shapes
   ========================================================================== */

.background-shapes {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  overflow: hidden;
}
.shape {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  animation: float 15s infinite ease-in-out;
}
[data-theme="dark"] .shape {
  background: rgba(255, 255, 255, 0.05);
  box-shadow: 0 0 20px rgba(96, 165, 250, 0.2); /* Subtle Neon Glow */
}
.shape1 {
  width: 200px;
  height: 200px;
  top: 10%;
  left: 20%;
}
.shape2 {
  width: 150px;
  height: 150px;
  top: 50%;
  right: 15%;
}
.shape3 {
  width: 300px;
  height: 300px;
  bottom: 10%;
  left: 50%;
}
@keyframes float {
  0% {
    transform: translate(0, 0);
  }
  50% {
    transform: translate(30px, -30px);
  }
  100% {
    transform: translate(0, 0);
  }
}

/* ==========================================================================
   Responsive Design
   ========================================================================== */

@media (max-width: 768px) {
  .navbar {
    padding: 1rem;
  }
  .dashboard-row {
    grid-template-columns: 1fr;
  }
  .card-body {
    padding: 1.5rem;
  }
  .login-page {
    padding: 1rem;
  }
  .info-row .label,
  .info-row .value {
    display: block;
    width: 100%;
    border-left: none;
    padding: 0.5rem 1rem;
  }
  .info-row .label {
    background: var(--info-row-even-bg);
  }
  .action-bar {
    flex-wrap: wrap;
    justify-content: center;
  }
  .action-bar .btn {
    min-width: 120px;
    flex: 1 1 45%;
  }
}
@media (max-width: 576px) {
  .action-bar .btn {
    flex: 1 1 100%;
  }
}

/* ==========================================================================
   AOS Enhancements
   ========================================================================== */

[data-aos] {
  transition-property: transform, opacity;
}
[data-aos].aos-animate {
  transition-duration: 0.8s;
}
/* ==========================================================================
   Subscription Form Page
   ========================================================================== */

.subscription-form-page {
  padding: 2rem 1rem;
  min-height: 100vh;
  background: var(--dashboard-bg);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.subscription-card {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: var(--glass-border);
  border-radius: 16px;
  box-shadow: var(--shadow);
  max-width: 900px; /* زيادة الحد الأقصى للعرض للشاشات العريضة */
  width: 100%;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.subscription-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
}

.card-header {
  background: var(--card-header-bg);
  color: #fff;
  font-weight: 600;
  padding: 1.5rem;
  text-align: center;
  border-radius: 16px 16px 0 0;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-size: 1.5rem;
}

.card-body {
  padding: 2.5rem; /* زيادة التباعد للشاشات العريضة */
}

/* Form Grid Layout */
.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* تخطيط عمودين للشاشات العريضة */
  gap: 1.5rem;
}

@media (max-width: 992px) {
  .form-grid {
    grid-template-columns: 1fr; /* عمود واحد للشاشات المتوسطة والصغيرة */
  }
}

/* Form Styling */
.form-control {
  background: var(--form-control-bg);
  border: none;
  border-radius: 0 10px 10px 0;
  padding: 0.75rem;
  color: var(--text-color);
  transition: background 0.3s ease, box-shadow 0.3s ease;
}

.form-control:focus {
  background: var(--form-control-focus-bg);
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
  outline: none;
}

.form-control::placeholder {
  color: var(--muted-color);
}

.input-group-text {
  background: var(--card-header-bg);
  color: #fff;
  border: none;
  border-radius: 10px 0 0 10px;
  padding: 0.75rem;
}

.form-label {
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 0.5rem;
}

/* Validation Feedback */
.invalid-feedback {
  display: none;
  color: var(--accent-color);
  font-size: 0.9rem;
  margin-top: 0.25rem;
}

.was-validated .form-control:invalid,
.form-control.is-invalid {
  border-color: var(--accent-color);
  background-image: none;
}

.was-validated .form-control:invalid:focus,
.form-control.is-invalid:focus {
  box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.3);
}

.was-validated .form-control:invalid ~ .invalid-feedback,
.form-control.is-invalid ~ .invalid-feedback {
  display: block;
}

/* Buttons */
.btn-primary,
.btn-secondary {
  border: none;
  border-radius: 10px;
  padding: 0.75rem;
  font-weight: 600;
  color: #fff;
  transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
}

.btn-primary {
  background: var(--btn-primary-bg);
}

.btn-secondary {
  background: linear-gradient(45deg, var(--muted-color), var(--text-color));
}

.btn-primary:hover,
.btn-secondary:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(96, 165, 250, 0.5);
}

/* Responsive Design */
@media (min-width: 1200px) {
  .subscription-card {
    max-width: 1000px; /* عرض أكبر للشاشات العريضة جدًا */
  }

  .card-body {
    padding: 3rem;
  }

  .form-grid {
    gap: 2rem; /* زيادة التباعد للشاشات العريضة */
  }
}

@media (max-width: 768px) {
  .subscription-form-page {
    padding: 1rem;
  }

  .subscription-card {
    max-width: 100%;
  }

  .card-body {
    padding: 1.5rem;
  }

  .form-control,
  .input-group-text {
    font-size: 0.9rem;
  }
}

@media (max-width: 576px) {
  .card-header {
    font-size: 1.2rem;
    padding: 1rem;
  }

  .btn-primary,
  .btn-secondary {
    padding: 0.6rem;
    font-size: 0.9rem;
  }
}
/* إخفاء الناف بار العلوي وززر السلايد بار على الشاشات الصغيرة */
@media (max-width: 991.98px) {
    #mainNavbar {
        display: none !important; /* إخفاء الناف بار العلوي بالكامل */
    }
    #mainNavbar .navbar-toggler {
        display: none !important; /* إخفاء زر السلايد بار */
    }
    #bottomNavbar {
        display: flex !important; /* إظهار الناف بار السفلي */
    }
}

/* تأكيد إخفاء الناف بار العلوي في صفحة تسجيل الدخول */
#loginPage:not([style*="display: none"]) ~ #mainNavbar,
#loginPage:not([style*="display: none"]) ~ #bottomNavbar {
    display: none !important; /* إخفاء كلا الناف بارين في صفحة تسجيل الدخول */
}

/* إزالة تأثيرات AOS من الناف بار السفلي */
#bottomNavbar {
    animation: none !important;
    transition: none !important;
}
.status-badge {
  white-space: nowrap;
}
@media (max-width: 400px) {
  .status-badge { white-space: normal; }
}
</style>
</head>
<body>
    <!-- Background Shapes -->
    <div class="background-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-content">
        <div class="energy-core"></div>
        <div class="particle-container">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>
        <p class="loading-text">جاري التحميل</p>
    </div>
</div>

    <!-- Navbar علوي (للحواسيب) -->
<nav class="navbar navbar-expand-lg d-none d-lg-flex" id="mainNavbar" data-aos="fade-down" style="display: none;">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      <i class="fas fa-shopping-cart"></i> نظام إشتراكات علي شوب
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showDashboard()">
            <i class="fas fa-tachometer-alt"></i> لوحة التحكم
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showPage('subscriptionFormPage')">
            <i class="fas fa-plus-circle"></i> إضافة اشتراك
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="showPage('subscriptionSummaryPage')">
            <i class="fas fa-list"></i> عرض الاشتراكات
          </a>
        </li>
        <li class="nav-item">
          <a class="theme-toggle" href="#" onclick="toggleTheme()">
            <i id="themeIcon" class="fas fa-moon"></i>
            <span id="themeText">الوضع الليلي</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Navbar سفلي (للموبايل) -->
<nav id="bottomNavbar" class="bottom-navbar d-lg-none" style="display: none;">
  <a href="#" class="nav-link" onclick="activateBottomNav(this); showDashboard()">
    <i class="fas fa-tachometer-alt"></i>
    <span>لوحة التحكم</span>
  </a>
  <a href="#" class="nav-link" onclick="activateBottomNav(this); showPage('subscriptionFormPage')">
    <i class="fas fa-plus-circle"></i>
    <span>إضافة</span>
  </a>
  <a href="#" class="nav-link" onclick="activateBottomNav(this); showPage('subscriptionSummaryPage')">
    <i class="fas fa-list"></i>
    <span>اشتراكات</span>
  </a>
  <a href="#" class="nav-link" onclick="activateBottomNav(this); toggleTheme()">
    <i id="bottomThemeIcon" class="fas fa-moon"></i>
    <span>الوضع</span>
  </a>
</nav>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-card glass-effect" data-aos="zoom-in" data-aos-delay="200">
            <div class="login-card-header">
                تسجيل الدخول
            </div>
            <div class="login-card-body">
                <form id="loginForm" onsubmit="event.preventDefault(); authenticateUser();">
                    <div class="mb-3">
                        <label for="pinCode" class="form-label">رمز الدخول</label>
                        <input type="password" class="form-control" id="pinCode" placeholder="أدخل رمز الدخول" required>
                        <div id="pinError" class="error-message"></div>
                    </div>
                    <button type="submit" class="btn-login">تسجيل الدخول</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="dashboard-page" style="display: none;">
        <h4 class="text-center mb-4" data-aos="fade-up">لوحة التحكم</h4>
        <div class="dashboard-row">
            <div class="dashboard-card total glass-effect" data-aos="fade-up" data-aos-delay="100">
                <h5>إجمالي الاشتراكات</h5>
                <p id="totalSubscriptions">0</p>
            </div>
            <div class="dashboard-card active glass-effect" data-aos="fade-up" data-aos-delay="200">
                <h5>الاشتراكات النشطة</h5>
                <p id="activeSubscriptions">0</p>
            </div>
            <div class="dashboard-card expired glass-effect" data-aos="fade-up" data-aos-delay="300">
                <h5>الاشتراكات المنتهية</h5>
                <p id="expiredSubscriptions">0</p>
            </div>
            <div class="dashboard-card warning glass-effect" data-aos="fade-up" data-aos-delay="400">
                <h5>اشتراكات تنتهي قريباً</h5>
                <p id="endingSoonSubscriptions">0</p>
            </div>
        </div>
        <div class="mt-5" data-aos="fade-up" data-aos-delay="500">
            <canvas id="subscriptionsChart" style="max-height: 400px;"></canvas>
        </div>
    </div>

    <!-- Subscription Form Page -->
<div id="subscriptionFormPage" class="subscription-form-page" style="display: none;">
    <div class="container">
        <div class="card glass-effect shadow-lg mx-auto subscription-card" data-aos="fade-up">
            <div class="card-header text-center">
                <i class="fas fa-plus-circle me-2"></i> إضافة اشتراك جديد
            </div>
            <div class="card-body p-4">
                <form id="subscriptionForm" class="needs-validation" novalidate>
                    <div class="form-grid">
                        <div class="mb-3 position-relative">
                            <label for="clientName" class="form-label">اسم العميل</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control" id="clientName" placeholder="أدخل اسم العميل" required>
                                <div class="invalid-feedback">الرجاء إدخال اسم العميل.</div>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="serviceName" class="form-label">اسم الخدمة</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-briefcase"></i></span>
                                <input type="text" class="form-control" id="serviceName" placeholder="أدخل اسم الخدمة" required>
                                <div class="invalid-feedback">الرجاء إدخال اسم الخدمة.</div>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="clientNumber" class="form-label">رقم العميل</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                <input type="tel" class="form-control" id="clientNumber" placeholder="أدخل رقم العميل" pattern="[0-9]{8,15}" required>
                                <div class="invalid-feedback">الرجاء إدخال رقم هاتف صالح.</div>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="clientEmail" class="form-label">البريد الإلكتروني</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                <input type="email" class="form-control" id="clientEmail" placeholder="أدخل البريد الإلكتروني" required>
                                <div class="invalid-feedback">الرجاء إدخال بريد إلكتروني صالح.</div>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="startDate" class="form-label">تاريخ البدء</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                <input type="date" class="form-control" id="startDate" required>
                                <div class="invalid-feedback">الرجاء اختيار تاريخ البدء.</div>
                            </div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label for="endDate" class="form-label">تاريخ الانتهاء</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                                <input type="date" class="form-control" id="endDate" required>
                                <div class="invalid-feedback">الرجاء اختيار تاريخ الانتهاء.</div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex gap-2 mt-4">
                        <button type="button" id="saveButton" class="btn btn-primary flex-fill" onclick="addOrUpdateSubscription()">إضافة الاشتراك</button>
                        <button type="button" class="btn btn-secondary flex-fill" onclick="resetForm()">إعادة تعيين</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

    <!-- Subscription Summary Page -->
    <div id="subscriptionSummaryPage" class="container mt-5" style="display: none;">
        <h4 class="text-center mb-4" data-aos="fade-up">ملخص الاشتراكات</h4>
        <div class="input-group mb-4 mx-auto" style="max-width: 500px;" data-aos="fade-up" data-aos-delay="100">
            <input type="text" class="form-control" placeholder="ابحث عن اشتراك" onkeyup="filterSubscriptions(this.value)">
            <button class="btn btn-primary" type="button"><i class="fas fa-search"></i></button>
        </div>
        <div class="d-flex justify-content-center mb-4" data-aos="fade-up" data-aos-delay="200">
  <div class="btn-group">
    <button type="button" class="btn btn-primary active" onclick="showActiveSubscriptions()">الاشتراكات النشطة</button>
    <button type="button" class="btn btn-warning" onclick="showEndingSoonSubscriptions()">ستنتهي قريباً</button>
    <button type="button" class="btn btn-secondary" onclick="showExpiredSubscriptions()">الاشتراكات المنتهية</button>
  </div>
</div>
        <div id="subscriptionDetails"></div>
<div id="endingSoonSubscriptionsDetails" style="display: none;"></div>
<div id="expiredSubscriptionsDetails" style="display: none;"></div>

    <!-- JavaScript -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <!-- AOS JavaScript -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true,
            offset: 100
        });

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD77vesY6cOzD78gVlxpye4eMfGrM-4JnU",
            authDomain: "alishop-b3205.firebaseapp.com",
            projectId: "alishop-b3205",
            storageBucket: "alishop-b3205.firebasestorage.app",
            messagingSenderId: "403562671782",
            appId: "1:403562671782:web:e547e38f51b3746ce30e67",
            measurementId: "G-Q78V7XHWZ7"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let editingId = null;

        
        // Show/Hide Pages
// Show/Hide Pages
function showPage(pageId) {
    console.log(`Showing page: ${pageId}`);
    const mainNavbar = document.getElementById('mainNavbar');
    const bottomNavbar = document.getElementById('bottomNavbar');
    const isSmallScreen = window.innerWidth < 992; // التحقق من حجم الشاشة

    // إخفاء أو إظهار الناف بارات بناءً على الصفحة وحجم الشاشة
    if (pageId === 'loginPage') {
        mainNavbar.style.display = 'none';
        bottomNavbar.style.display = 'none';
    } else {
        if (isSmallScreen) {
            mainNavbar.style.display = 'none'; // إخفاء الناف بار العلوي على الشاشات الصغيرة
            bottomNavbar.style.display = 'flex'; // إظهار الناف بار السفلي
        } else {
            mainNavbar.style.display = 'flex'; // إظهار الناف بار العلوي على الشاشات الكبيرة
            bottomNavbar.style.display = 'none'; // إخفاء الناف بار السفلي
            mainNavbar.classList.add('active');
        }
    }

    showLoading();
    setTimeout(() => {
        // إخفاء جميع الصفحات
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboardPage').style.display = 'none';
        document.getElementById('subscriptionFormPage').style.display = 'none';
        document.getElementById('subscriptionSummaryPage').style.display = 'none';

        // إظهار الصفحة المطلوبة
        document.getElementById(pageId).style.display = 'block';

        // لو دخلنا إلى صفحة الاشتراكات، فعل الاشتراكات النشطة تلقائياً
        if (pageId === 'subscriptionSummaryPage') {
            showActiveSubscriptions();
        }

        hideLoading();
    }, 500);
}
        // Authentication
        function authenticateUser() {
            console.log("Attempting to authenticate user...");
            const pinCode = document.getElementById('pinCode').value.trim();
            const validPin = "1234"; // Replace with Firebase Auth in production
            const errorMessage = document.getElementById('pinError');

            if (!pinCode) {
                console.log("PIN is empty");
                errorMessage.textContent = "الرجاء إدخال رمز الدخول!";
                errorMessage.style.display = 'block';
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'الرجاء إدخال رمز الدخول!',
                    confirmButtonColor: '#dc3545'
                });
                return;
            }

            if (pinCode === validPin) {
                console.log("PIN is valid, logging in...");
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('loginExpiry', new Date().getTime() + 60 * 60 * 1000);
                errorMessage.style.display = 'none';
                document.getElementById('loginForm').reset();
                showPage('subscriptionSummaryPage');
                Swal.fire({
                    icon: 'success',
                    title: 'نجاح',
                    text: 'تم تسجيل الدخول بنجاح!',
                    timer: 1500,
                    showConfirmButton: false
                });
            } else {
                console.log("Invalid PIN");
                errorMessage.textContent = "رمز الدخول غير صحيح!";
                errorMessage.style.display = 'block';
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'رمز الدخول غير صحيح!',
                    confirmButtonColor: '#dc3545'
                });
            }
        }

        // Form Submission
        function addOrUpdateSubscription() {
            const subscription = {
                clientName: document.getElementById('clientName').value,
                serviceName: document.getElementById('serviceName').value,
                clientNumber: document.getElementById('clientNumber').value,
                clientEmail: document.getElementById('clientEmail').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value
            };

            if (editingId) {
                db.collection('subscriptions').doc(editingId).update(subscription)
                    .then(() => {
                        Swal.fire('نجاح', 'تم تعديل الاشتراك بنجاح!', 'success');
                        resetForm();
                        showPage('subscriptionSummaryPage');
                    })
                    .catch(error => Swal.fire('خطأ', 'حدث خطأ: ' + error.message, 'error'));
            } else {
                db.collection('subscriptions').add(subscription)
                    .then(() => {
                        Swal.fire('نجاح', 'تمت إضافة الاشتراك بنجاح!', 'success');
                        resetForm();
                        showPage('subscriptionSummaryPage');
                    })
                    .catch(error => Swal.fire('خطأ', 'حدث خطأ: ' + error.message, 'error'));
            }
        }

        function resetForm() {
            document.getElementById('subscriptionForm').reset();
            document.getElementById('saveButton').textContent = 'إضافة الاشتراك';
            editingId = null;
        }

        // Show Active Subscriptions
        function showActiveSubscriptions() {
  const [btnActive, btnSoon, btnExpired] = document.querySelectorAll('.btn-group .btn');
  btnActive.classList.add('active'); btnSoon.classList.remove('active'); btnExpired.classList.remove('active');

  document.getElementById('subscriptionDetails').style.display = 'block';
  document.getElementById('endingSoonSubscriptionsDetails').style.display = 'none';
  document.getElementById('expiredSubscriptionsDetails').style.display = 'none';

  displaySubscriptions('active');
}

function showEndingSoonSubscriptions() {
  const [btnActive, btnSoon, btnExpired] = document.querySelectorAll('.btn-group .btn');
  btnActive.classList.remove('active'); btnSoon.classList.add('active'); btnExpired.classList.remove('active');

  document.getElementById('subscriptionDetails').style.display = 'none';
  document.getElementById('endingSoonSubscriptionsDetails').style.display = 'block';
  document.getElementById('expiredSubscriptionsDetails').style.display = 'none';

  displaySubscriptions('soon');
}

function showExpiredSubscriptions() {
  const [btnActive, btnSoon, btnExpired] = document.querySelectorAll('.btn-group .btn');
  btnActive.classList.remove('active'); btnSoon.classList.remove('active'); btnExpired.classList.add('active');

  document.getElementById('subscriptionDetails').style.display = 'none';
  document.getElementById('endingSoonSubscriptionsDetails').style.display = 'none';
  document.getElementById('expiredSubscriptionsDetails').style.display = 'block';

  displaySubscriptions('expired');
}
        // Display Subscriptions
        function displaySubscriptions(type = 'active') {
  const container =
    type === 'active'
      ? document.getElementById('subscriptionDetails')
      : type === 'soon'
      ? document.getElementById('endingSoonSubscriptionsDetails')
      : document.getElementById('expiredSubscriptionsDetails');

  container.innerHTML = '';
  const countdownTargets = [];

  db.collection('subscriptions').get().then(querySnapshot => {
    if (querySnapshot.empty) {
      container.innerHTML = '<p class="text-center text-muted mt-4">لا توجد اشتراكات متاحة.</p>';
      return;
    }

    const today = new Date();

    querySnapshot.forEach((doc, index) => {
      const sub = doc.data();
      const id = doc.id;

      const endDate = new Date(sub.endDate);
      const isExpired = endDate < new Date(today.toDateString()); // تجاهل وقت اليوم
      const diffTime = Math.abs(endDate - today);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      // قواعد العرض:
      // active: غير منتهي و أكثر من 7 أيام
      // soon:   غير منتهي و ≤ 7 أيام
      // expired: منتهي
      if (type === 'active' && (isExpired || diffDays <= 7)) return;
      if (type === 'soon' && (isExpired || diffDays > 7)) return;
      if (type === 'expired' && !isExpired) return;

      // الشارة
      let statusBadge = '';
      if (isExpired) {
        statusBadge = `<span class="status-badge expired">منتهي منذ ${diffDays} يوم</span>`;
      } else if (diffDays <= 7) {
        statusBadge = `<span class="status-badge warning">ينتهي قريباً (${diffDays} يوم)</span>`;
      } else {
        statusBadge = `<span class="status-badge active">نشط</span>`;
      }

      // صف “انتهى منذ …” داخل التفاصيل عند الانتهاء
      const expiredRow = isExpired
        ? `
        <div class="info-row">
          <span class="label"><i class="fas fa-hourglass-end"></i>الحالة</span>
          <span class="value">انتهى منذ ${diffDays} يوم</span>
        </div>`
        : '';

      const timeRow = !isExpired
        ? `
        <div class="info-row">
          <span class="label"><i class="fas fa-clock"></i>الوقت المتبقي</span>
          <span class="value" id="time-remaining-${id}"></span>
        </div>`
        : '';

      const card = `
        <div class="summary-card glass-effect fade-in" id="${id}" data-aos="fade-up" data-aos-delay="${index * 100}">
          <div class="header" onclick="toggleExpand('${id}')">
            <h5>
              <i class="fas fa-user me-2"></i>
              ${sub.clientName || 'غير محدد'} ${statusBadge}
            </h5>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="content">
            <div class="info-container">
              <div class="info-table">
                <div class="info-row">
                  <span class="label"><i class="fas fa-briefcase"></i>اسم الخدمة</span>
                  <span class="value">${sub.serviceName || 'غير محدد'}</span>
                </div>
                <div class="info-row">
                  <span class="label"><i class="fas fa-phone"></i>رقم العميل</span>
                  <span class="value">${sub.clientNumber || 'غير محدد'}</span>
                </div>
                <div class="info-row">
                  <span class="label"><i class="fas fa-envelope"></i>البريد الإلكتروني</span>
                  <span class="value">${sub.clientEmail || 'غير محدد'}</span>
                </div>
                <div class="info-row">
                  <span class="label"><i class="fas fa-calendar-alt"></i>تاريخ البدء</span>
                  <span class="value">${sub.startDate || 'غير محدد'}</span>
                </div>
                <div class="info-row">
                  <span class="label"><i class="fas fa-calendar-check"></i>تاريخ الانتهاء</span>
                  <span class="value">${sub.endDate || 'غير محدد'}</span>
                </div>
                ${expiredRow}
                ${timeRow}
              </div>
            </div>
            <div class="action-bar">
              <button class="btn btn-success" onclick="openWhatsApp('${sub.clientNumber || ''}', '${id}')">
                <i class="fab fa-whatsapp me-1"></i> واتساب
              </button>
              ${isExpired ? `
              <button class="btn btn-primary" onclick="editSubscription('${id}')">
                <i class="fas fa-sync-alt me-1"></i> تجديد
              </button>` : `
              <button class="btn btn-warning" onclick="editSubscription('${id}')">
                <i class="fas fa-edit me-1"></i> تعديل
              </button>`}
              <button class="btn btn-danger" onclick="deleteSubscription('${id}')">
                <i class="fas fa-trash me-1"></i> حذف
              </button>
            </div>
          </div>
        </div>`;

      container.innerHTML += card;

      // جهّز العداد للغير منتهي: للنشطة + ستنتهي قريباً
      if (!isExpired) {
        countdownTargets.push({ id, endDate });
      }
    });

    // فعّل العدّاد في “النشطة” و“ستنتهي قريباً”
    if (type === 'active' || type === 'soon') {
      startGlobalCountdown(countdownTargets);
    }
  }).catch(error => {
    Swal.fire('خطأ', 'حدث خطأ أثناء استرجاع البيانات: ' + error.message, 'error');
  });
}

        // Edit Subscription
        function editSubscription(id) {
            db.collection('subscriptions').doc(id).get().then(doc => {
                const sub = doc.data();
                const endDate = new Date(sub.endDate);
                const today = new Date();
                const isExpired = endDate < today;

                if (isExpired) {
                    Swal.fire({
                        title: 'تجديد الاشتراك',
                        html: `
                            <div style="text-align: right; direction: rtl;">
                                <p>العميل: <strong>${sub.clientName || 'غير محدد'}</strong></p>
                                <p>الخدمة: <strong>${sub.serviceName || 'غير محدد'}</strong></p>
                                <p>تاريخ الانتهاء الحالي: <strong>${sub.endDate || 'غير محدد'}</strong></p>
                                <input type="date" id="renewDate" class="swal2-input" value="${sub.endDate}">
                            </div>`,
                        showCancelButton: true,
                        confirmButtonText: 'حفظ التجديد',
                        cancelButtonText: 'إلغاء'
                    }).then(result => {
                        if (result.isConfirmed) {
                            const newEndDate = document.getElementById('renewDate').value;
                            if (newEndDate) {
                                db.collection('subscriptions').doc(id).update({ endDate: newEndDate })
                                    .then(() => {
                                        Swal.fire('نجاح', 'تم تجديد الاشتراك!', 'success');
                                        showExpiredSubscriptions();
                                    })
                                    .catch(error => Swal.fire('خطأ', 'حدث خطأ: ' + error.message, 'error'));
                            }
                        }
                    });
                } else {
                    document.getElementById('clientName').value = sub.clientName || '';
                    document.getElementById('serviceName').value = sub.serviceName || '';
                    document.getElementById('clientNumber').value = sub.clientNumber || '';
                    document.getElementById('clientEmail').value = sub.clientEmail || '';
                    document.getElementById('startDate').value = sub.startDate || '';
                    document.getElementById('endDate').value = sub.endDate || '';
                    editingId = id;
                    document.getElementById('saveButton').textContent = 'حفظ التعديلات';
                    showPage('subscriptionFormPage');
                }
            }).catch(error => {
                Swal.fire('خطأ', 'حدث خطأ أثناء استرجاع البيانات: ' + error.message, 'error');
            });
        }

        // Delete Subscription
        function deleteSubscription(id) {
            Swal.fire({
                title: 'تأكيد الحذف',
                text: 'هل أنت متأكد من حذف هذا الاشتراك؟',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'نعم، احذف',
                cancelButtonText: 'إلغاء'
            }).then(result => {
                if (result.isConfirmed) {
                    db.collection('subscriptions').doc(id).delete()
                        .then(() => {
                            Swal.fire('نجاح', 'تم حذف الاشتراك بنجاح!', 'success');
                            const currentTab = document.getElementById('expiredSubscriptionsDetails').style.display === 'block' ? 'expired' : 'active';
                            displaySubscriptions(currentTab);
                        })
                        .catch(error => Swal.fire('خطأ', 'حدث خطأ: ' + error.message, 'error'));
                }
            });
        }

        // WhatsApp Integration
        async function openWhatsApp(phoneNumber, subscriptionId) {
            try {
                const cleanedNumber = phoneNumber.toString().trim().replace(/\D/g, '');
                if (!cleanedNumber || cleanedNumber.length < 8) {
                    Swal.fire('خطأ', 'رقم الهاتف غير صالح!', 'error');
                    return;
                }

                const doc = await db.collection('subscriptions').doc(subscriptionId).get();
                if (!doc.exists) {
                    Swal.fire('خطأ', 'لم يتم العثور على بيانات الاشتراك!', 'error');
                    return;
                }
                const sub = doc.data();

                const formatDate = dateString => {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('ar-EG', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                };

                const now = new Date();
                const endDate = new Date(sub.endDate);
                const timeDiff = endDate - now;
                let remainingText = '';
                if (timeDiff > 0) {
                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    remainingText = days > 0 ? `${days} يوم و${hours} ساعة` : `${hours} ساعة`;
                } else {
                    remainingText = 'منتهي';
                }

                const message = `
🌟 رسالة تلقائية من نظام إشتراكات علي شوب🌟
━━━━━━━━━━━━━━━━━━━━━
👤 *العميل*: ${sub.clientNumber || 'غير محدد'}
📌 *الخدمة*: ${sub.serviceName || 'غير محدد'}
━━━━━━━━━━━━━━━━━━━━━
📅 *تاريخ البدء*: ${formatDate(sub.startDate) || 'غير محدد'}
📅 *تاريخ الانتهاء*: ${formatDate(sub.endDate) || 'غير محدد'}
⏳ *الوقت المتبقي*: ${remainingText}
━━━━━━━━━━━━━━━━━━━━━
${timeDiff > 0 && timeDiff <= 7 * 24 * 60 * 60 * 1000 ? '⚠️ *تنبيه*: اشتراكك ينتهي قريباً! يرجى التجديد.' : timeDiff <= 0 ? '🔴 *ملاحظة*: الاشتراك منتهي. تواصل معنا للتجديد!' : '✅ *حالة الاشتراك*: نشط'}
━━━━━━━━━━━━━━━━━━━━━
📞 تواصل معنا للمزيد من المعلومات!
شكراً لثقتك بنا! 💙`;

                window.open(`https://wa.me/${cleanedNumber}?text=${encodeURIComponent(message)}`, '_blank');
            } catch (error) {
                Swal.fire('خطأ', 'حدث خطأ أثناء إرسال الرسالة: ' + error.message, 'error');
            }
        }

        // Countdown Timer
        function startGlobalCountdown(subscriptions) {
            function updateCountdowns() {
                const now = new Date();
                subscriptions.forEach(({ id, endDate }) => {
                    const timeElement = document.getElementById(`time-remaining-${id}`);
                    if (!timeElement) return;
                    const timeDiff = endDate - now;
                    if (timeDiff <= 0) {
                        timeElement.innerHTML = "<span class='text-danger'>انتهى الاشتراك!</span>";
                        return;
                    }

                    const millisecondsPerMonth = 1000 * 60 * 60 * 24 * 30;
                    const months = Math.floor(timeDiff / millisecondsPerMonth);
                    const remainingAfterMonths = timeDiff % millisecondsPerMonth;
                    const days = Math.floor(remainingAfterMonths / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((remainingAfterMonths % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((remainingAfterMonths % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remainingAfterMonths % (1000 * 60)) / 1000);

                    let countdownText = '';
                    if (months > 0) {
                        countdownText += `${months} شهر `;
                    }
                    countdownText += `${days} يوم ${hours} ساعة ${minutes} دقيقة ${seconds} ثانية`;
                    timeElement.textContent = countdownText.trim();
                });
            }
            updateCountdowns();
            return setInterval(updateCountdowns, 1000);
        }

// Dashboard
function showDashboard() {
    console.log("Showing dashboard...");
    const mainNavbar = document.getElementById('mainNavbar');
    const bottomNavbar = document.getElementById('bottomNavbar');
    const isSmallScreen = window.innerWidth < 992;

    showLoading();
    setTimeout(() => {
        document.getElementById('dashboardPage').style.display = 'block';
        document.getElementById('subscriptionFormPage').style.display = 'none';
        document.getElementById('subscriptionSummaryPage').style.display = 'none';
        document.getElementById('loginPage').style.display = 'none';

        // إخفاء أو إظهار الناف بارات بناءً على حجم الشاشة
        if (isSmallScreen) {
            mainNavbar.style.display = 'none'; // إخفاء الناف بار العلوي
            bottomNavbar.style.display = 'flex'; // إظهار الناف بار السفلي
        } else {
            mainNavbar.style.display = 'flex';
            bottomNavbar.style.display = 'none';
            mainNavbar.classList.add('active');
        }

        db.collection('subscriptions').get().then(querySnapshot => {
            let total = 0, expired = 0, active = 0, endingSoon = 0;
            const today = new Date();
            const sevenDaysFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

            querySnapshot.forEach(doc => {
                total++;
                const endDate = new Date(doc.data().endDate);
                if (endDate < today) expired++;
                else if (endDate <= sevenDaysFromNow) endingSoon++;
                else active++;
            });

            document.getElementById('totalSubscriptions').textContent = total;
            document.getElementById('activeSubscriptions').textContent = active;
            document.getElementById('expiredSubscriptions').textContent = expired;
            document.getElementById('endingSoonSubscriptions').textContent = endingSoon;

            // Chart.js
            const ctx = document.getElementById('subscriptionsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['إجمالي', 'نشط', 'منتهي', 'ينتهي قريباً'],
                    datasets: [{
                        label: 'الاشتراكات',
                        data: [total, active, expired, endingSoon],
                        backgroundColor: ['#1e3a8a', '#4b6cb7', '#dc3545', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } }
                }
            });

            hideLoading();
        }).catch(error => {
            Swal.fire('خطأ', 'حدث خطأ أثناء استرجاع البيانات: ' + error.message, 'error');
            hideLoading();
        });
    }, 500);
}

        // Loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Filter Subscriptions
        function filterSubscriptions(query) {
  const containers = [
    document.getElementById('subscriptionDetails'),
    document.getElementById('endingSoonSubscriptionsDetails'),
    document.getElementById('expiredSubscriptionsDetails')
  ];
  containers.forEach(container => {
    const cards = container.getElementsByClassName('summary-card');
    Array.from(cards).forEach(card => {
      const clientNameElement = card.querySelector('.header h5');
      const serviceNameElement = card.querySelector('.info-row:nth-child(1) .value');
      const clientName = clientNameElement ? clientNameElement.textContent.toLowerCase() : '';
      const serviceName = serviceNameElement ? serviceNameElement.textContent.toLowerCase() : '';
      card.style.display = clientName.includes(query.toLowerCase()) || serviceName.includes(query.toLowerCase()) ? 'block' : 'none';
    });
  });
}

        // Toggle Expand
        function toggleExpand(id) {
            const card = document.getElementById(id);
            card.classList.toggle('expanded');
            const content = card.querySelector('.content');
            const chevron = card.querySelector('.header i:last-child');
            if (card.classList.contains('expanded')) {
                content.style.display = 'block';
                chevron.classList.replace('fa-chevron-down', 'fa-chevron-up');
            } else {
                content.style.display = 'none';
                chevron.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        }

        // Initialize
window.onload = function () {
    console.log("Initializing page...");
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    const loginExpiry = localStorage.getItem('loginExpiry');
    const mainNavbar = document.getElementById('mainNavbar');
    const bottomNavbar = document.getElementById('bottomNavbar');
    const isSmallScreen = window.innerWidth < 992;

    // إخفاء الناف بارات فورًا عند التحميل
    mainNavbar.style.display = 'none';
    bottomNavbar.style.display = 'none';

    if (isLoggedIn && loginExpiry && new Date().getTime() < parseInt(loginExpiry)) {
        console.log("User is logged in, showing summary page");
        if (isSmallScreen) {
            mainNavbar.style.display = 'none'; // إخفاء الناف بار العلوي على الشاشات الصغيرة
            bottomNavbar.style.display = 'flex'; // إظهار الناف بار السفلي
        } else {
            mainNavbar.style.display = 'flex';
            bottomNavbar.style.display = 'none';
            mainNavbar.classList.add('active');
        }

        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('dashboardPage').style.display = 'none';
        document.getElementById('subscriptionFormPage').style.display = 'none';
        document.getElementById('subscriptionSummaryPage').style.display = 'block';
        showActiveSubscriptions();
    } else {
        console.log("User is not logged in, showing login page");
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('loginExpiry');

        document.getElementById('loginPage').style.display = 'block';
        document.getElementById('dashboardPage').style.display = 'none';
        document.getElementById('subscriptionFormPage').style.display = 'none';
        document.getElementById('subscriptionSummaryPage').style.display = 'none';
    }
};
        // Theme Toggle
function toggleTheme() {
    const html = document.documentElement;
    const themeIcon = document.getElementById('bottomThemeIcon'); // ايقونة النافبار السفلي
    const themeText = document.getElementById('themeText');       // نص الوضع الليلي في النافبار العلوي (اختياري لو عندك)
    const mainThemeIcon = document.getElementById('themeIcon');   // ايقونة النافبار العلوي

    const currentTheme = html.getAttribute('data-theme');

    if (currentTheme === 'dark') {
        html.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
        
        // تغيير الأيقونات للنمط النهاري
        if (themeIcon) themeIcon.classList.replace('fa-sun', 'fa-moon');
        if (mainThemeIcon) mainThemeIcon.classList.replace('fa-sun', 'fa-moon');
        if (themeText) themeText.textContent = 'الوضع الليلي';
    } else {
        html.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        
        // تغيير الأيقونات للنمط الليلي
        if (themeIcon) themeIcon.classList.replace('fa-moon', 'fa-sun');
        if (mainThemeIcon) mainThemeIcon.classList.replace('fa-moon', 'fa-sun');
        if (themeText) themeText.textContent = 'الوضع النهاري';
    }
}

// عند تحميل الصفحة تأكد أن يتم ضبط الأيقونة حسب الوضع المحفوظ
window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme');
    const html = document.documentElement;
    const themeIcon = document.getElementById('bottomThemeIcon');
    const mainThemeIcon = document.getElementById('themeIcon');
    const themeText = document.getElementById('themeText');

    if (savedTheme === 'dark') {
        html.setAttribute('data-theme', 'dark');
        if (themeIcon) themeIcon.classList.replace('fa-moon', 'fa-sun');
        if (mainThemeIcon) mainThemeIcon.classList.replace('fa-moon', 'fa-sun');
        if (themeText) themeText.textContent = 'الوضع النهاري';
    } else {
        html.removeAttribute('data-theme');
        if (themeIcon) themeIcon.classList.replace('fa-sun', 'fa-moon');
        if (mainThemeIcon) mainThemeIcon.classList.replace('fa-sun', 'fa-moon');
        if (themeText) themeText.textContent = 'الوضع الليلي';
    }
});
// Active Link Highlighting
document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', function () {
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
    });
});

// Ensure active link on page load
window.addEventListener('DOMContentLoaded', () => {
    const currentPage = window.location.hash || '#subscriptionSummaryPage';
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        if (link.getAttribute('onclick').includes(currentPage.replace('#', ''))) {
            link.classList.add('active');
        }
    });
});
// Randomize Particle Movement
document.querySelectorAll('.particle').forEach(particle => {
    particle.style.setProperty('--random-x', Math.random() * 2 - 1);
    particle.style.setProperty('--random-y', Math.random() * 2 - 1);
});
// Form Validation
document.getElementById('subscriptionForm').addEventListener('submit', function (event) {
    event.preventDefault();
    if (!this.checkValidity()) {
        event.stopPropagation();
        this.classList.add('was-validated');
    } else {
        addOrUpdateSubscription();
    }
});

// Reset Validation on Form Reset
function resetForm() {
    document.getElementById('subscriptionForm').reset();
    document.getElementById('subscriptionForm').classList.remove('was-validated');
    document.getElementById('saveButton').textContent = 'إضافة الاشتراك';
    editingId = null;
}
// Reset Form with Animation
function resetForm() {
    const form = document.getElementById('subscriptionForm');
    form.reset();
    form.classList.remove('was-validated');
    document.getElementById('saveButton').textContent = 'إضافة الاشتراك';
    editingId = null;
    // إضافة تأثير تلاشي عند إعادة التعيين
    form.style.transition = 'opacity 0.3s ease';
    form.style.opacity = '0';
    setTimeout(() => {
        form.style.opacity = '1';
    }, 300);
}
function activateBottomNav(selectedLink) {
  document.querySelectorAll('#bottomNavbar .nav-link').forEach(link => link.classList.remove('active'));
  selectedLink.classList.add('active');
}
// تحديث الناف بارات عند تغيير حجم الشاشة
window.addEventListener('resize', () => {
    const isSmallScreen = window.innerWidth < 992;
    const mainNavbar = document.getElementById('mainNavbar');
    const bottomNavbar = document.getElementById('bottomNavbar');

    if (document.getElementById('loginPage').style.display === 'block') {
        mainNavbar.style.display = 'none';
        bottomNavbar.style.display = 'none';
    } else {
        if (isSmallScreen) {
            mainNavbar.style.display = 'none';
            bottomNavbar.style.display = 'flex';
        } else {
            mainNavbar.style.display = 'flex';
            bottomNavbar.style.display = 'none';
            mainNavbar.classList.add('active');
        }
    }
});
    </script>
</body>
</html>